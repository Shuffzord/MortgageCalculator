npm test

> rest-express@1.0.0 test
> jest


 RUNS  client/src/lib/calculationEngine.test.ts
 RUNS  client/src/lib/comprehensive-tests/interest-rate-changes.test.ts
 RUNS  client/src/lib/comprehensive-tests/overpayment.test.ts
 RUNS  client/src/lib/comprehensive-tests/edge-cases.test.ts
 RUNS  client/src/li
 FAIL  client/src/lib/calculationEngine.test.ts (20.29 s)
  ● Console

    console.log
      Running calculateMonthlyPayment test: standard case

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:43:15)

    console.log
      Running calculateMonthlyPayment test: 0% interest rate

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:50:15)

    console.log
      Running calculateMonthlyPayment test: very high interest rates

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:57:15)

    console.log
      Running calculateMonthlyPayment test: very short term

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:64:15)

    console.log
      Running generateAmortizationSchedule test: correct schedule length

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:73:15)

    console.log
      Running generateAmortizationSchedule test: first payment interest > principal

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:79:15)

    console.log
      Running generateAmortizationSchedule test: last payment pays off balance

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:85:15)

    console.log
      Running aggregateYearlyData test: aggregate data correctly

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:94:15)

    console.log
      Running aggregateYearlyData test: calculate total interest correctly

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:102:15)

    console.log
      Running applyOverpayment test: reduce loan term

      at client/src/lib/calculationEngine.test.ts:117:15

    console.log
      Running applyOverpayment test: reduce monthly payment

      at client/src/lib/calculationEngine.test.ts:125:15

  ● Mortgage Calculation Engine › generateAmortizationSchedule › should generate correct schedule length

    expect(received).toBe(expected) // Object.is equality

    Expected: 360
    Received: 361

      73 |       console.log('Running generateAmortizationSchedule test: correct schedule length');
      74 |       const schedule = generateAmortizationSchedule(250000, 4.5, 30);
    > 75 |       expect(schedule.length).toBe(360); // 30 years * 12 months
         |                               ^
      76 |     });
      77 |
      78 |     test('first payment should have more interest than principal', () => {

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:75:31)

  ● Mortgage Calculation Engine › generateAmortizationSchedule › last payment should pay off remaining balance

    expect(received).toBeCloseTo(expected)

    Expected: 0
    Received: 2.4866590706860734

    Expected precision:    2
    Expected difference: < 0.005
    Received difference:   2.4866590706860734

      86 |       const schedule = generateAmortizationSchedule(250000, 4.5, 30);
      87 |       // Now using balance property from PaymentData
    > 88 |       expect(schedule[359].balance).toBeCloseTo(0);
         |                                     ^
      89 |     });
      90 |   });
      91 |

      at Object.<anonymous> (client/src/lib/calculationEngine.test.ts:88:37)

 FAIL  client/src/lib/comprehensive-tests/amortization-validation.test.ts (34.248 s)
  ● Amortization Schedule Validation › A1: Amortization Schedule Validation for 15-year 3.5% Loan

    expect(received).toBeCloseTo(expected, precision)

    Expected: 1429.77
    Received: 1

    Expected precision:    2
    Expected difference: < 0.005
    Received difference:   1428.77

      30 |     // Test total payment amount is consistent throughout the schedule
      31 |     schedule.forEach(payment => {
    > 32 |       expect(Math.round(payment.monthlyPayment * 100) / 100).toBeCloseTo(expectedBreakdowns[0].total, 2);
         |                                                              ^
      33 |     });
      34 |     
      35 |     // Test specific payment breakdowns

      at client/src/lib/comprehensive-tests/amortization-validation.test.ts:32:62
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (client/src/lib/comprehensive-tests/amortization-validation.test.ts:31:14)

  ● Amortization Schedule Validation › A3: Round-Off Error Accumulation Test

    expect(received).toBeCloseTo(expected, precision)

    Expected: 1654.55
    Received: 1

    Expected precision:    2
    Expected difference: < 0.005
    Received difference:   1653.55

      74 |     
      75 |     // Verify monthly payment calculation
    > 76 |     expect(results.monthlyPayment).toBeCloseTo(expectedMonthlyPayment, 2);
         |                                    ^
      77 |     
      78 |     // Verify the final balance is zero
      79 |     expect(schedule[schedule.length - 1].balance).toBeCloseTo(0, 2);

      at Object.<anonymous> (client/src/lib/comprehensive-tests/amortization-validation.test.ts:76:36)

 PASS  client/src/lib/mortgage-calculator.test.ts
  ● Console

    console.log
      Running calculateMonthlyPayment test in mortgage-calculator.test.ts

      at Object.<anonymous> (client/src/lib/mortgage-calculator.test.ts:7:15)

    console.log
      Running generateAmortizationSchedule test in mortgage-calculator.test.ts

      at Object.<anonymous> (client/src/lib/mortgage-calculator.test.ts:19:15)

 PASS  client/src/lib/advancedMortgageScenarios.test.ts
  ● Console

    console.log
      Lump sum payment scenario:

      at client/src/lib/advancedMortgageScenarios.test.ts:88:13

    console.log
      Original term: 30.00 years

      at client/src/lib/advancedMortgageScenarios.test.ts:89:13

    console.log
      Term with lump sum payment: 30.00 years

      at client/src/lib/advancedMortgageScenarios.test.ts:90:13

    console.log
      Years saved: 0.00

      at client/src/lib/advancedMortgageScenarios.test.ts:91:13

    console.log
      Original total interest: $376,954.79

      at client/src/lib/advancedMortgageScenarios.test.ts:92:13

    console.log
      Total interest with lump sum: $349,179.40

      at client/src/lib/advancedMortgageScenarios.test.ts:93:13

    console.log
      Interest saved: $27,775.39

      at client/src/lib/advancedMortgageScenarios.test.ts:94:13

    console.log
      Interest saved percentage: 7.37%

      at client/src/lib/advancedMortgageScenarios.test.ts:95:13

    console.log
      Bi-weekly payment scenario:

      at client/src/lib/advancedMortgageScenarios.test.ts:152:13

    console.log
      Term with rate change only: 15 years 1 month

      at client/src/lib/advancedMortgageScenarios.test.ts:153:13

    console.log
      Term with bi-weekly payments: 15 years 1 month

      at client/src/lib/advancedMortgageScenarios.test.ts:154:13

    console.log
      Time saved:

      at client/src/lib/advancedMortgageScenarios.test.ts:155:13

    console.log
      Interest saved: $1,543.80

      at client/src/lib/advancedMortgageScenarios.test.ts:156:13

 FAIL  client/src/lib/comprehensive-tests/interest-rate-changes.test.ts
  ● Test suite failed to run

    client/src/lib/comprehensive-tests/interest-rate-changes.test.ts:132:7 - error TS2345: Argument of type '{ amount: number; startMonth: number; endMonth: number; isRecurring: boolean; frequency: string; }[]' is not assignable to parameter of type 'OverpaymentDetails[]'.
      Type '{ amount: number; startMonth: number; endMonth: number; isRecurring: boolean; frequency: string; }' is not assignable to type 'OverpaymentDetails'.
        Types of property 'frequency' are incompatible.
          Type 'string' is not assignable to type '"monthly" | "quarterly" | "annual" | "one-time"'.

    132       overpayments,
              ~~~~~~~~~~~~

 FAIL  client/src/lib/comprehensive-tests/edge-cases.test.ts (35.468 s)
  ● Mortgage Calculator Edge Cases › E1: Extra-Long Term Mortgage (40 years)

    expect(received).toBeCloseTo(expected, precision)

    Expected: 1363.95
    Received: 1

    Expected precision:    1
    Expected difference: < 0.05
    Received difference:   1362.95

      24 |     
      25 |     // Validate monthly payment
    > 26 |     expect(results.monthlyPayment).toBeCloseTo(expectedMonthlyPayment, 1);
         |                                    ^
      27 |     
      28 |     // Validate total interest
      29 |     expect(results.totalInterest).toBeCloseTo(expectedTotalInterest, 0);

      at Object.<anonymous> (client/src/lib/comprehensive-tests/edge-cases.test.ts:26:36)

  ● Mortgage Calculator Edge Cases › E2: Very Large Principal Amount

    expect(received).toBeCloseTo(expected, precision)

    Expected: 25334.37
    Received: 1

    Expected precision:    1
    Expected difference: < 0.05
    Received difference:   25333.37

      51 |     
      52 |     // Validate monthly payment
    > 53 |     expect(results.monthlyPayment).toBeCloseTo(expectedMonthlyPayment, 1);
         |                                    ^
      54 |     
      55 |     // Validate total interest
      56 |     expect(results.totalInterest).toBeCloseTo(expectedTotalInterest, 0);

      at Object.<anonymous> (client/src/lib/comprehensive-tests/edge-cases.test.ts:53:36)

  ● Mortgage Calculator Edge Cases › Zero Principal Amount

    TypeError: Cannot read properties of undefined (reading 'monthlyPayment')

      65 |   
      66 |   return {
    > 67 |     monthlyPayment: paymentData[0].monthlyPayment,
         |                                    ^
      68 |     totalInterest: cumulativeInterest,
      69 |     amortizationSchedule: paymentData,
      70 |     yearlyData: yearlyData,

      at calculateLoanDetails (client/src/lib/calculationEngine.ts:67:36)
      at Object.<anonymous> (client/src/lib/comprehensive-tests/edge-cases.test.ts:73:41)

  ● Mortgage Calculator Edge Cases › Zero Interest Rate

    expect(received).toBeCloseTo(expected, precision)

    Expected: 833.3333333333334
    Received: 1

    Expected precision:    2
    Expected difference: < 0.005
    Received difference:   832.3333333333334

      100 |     
      101 |     // Validate monthly payment is simply principal divided by number of payments
    > 102 |     expect(results.monthlyPayment).toBeCloseTo(expectedMonthlyPayment, 2);
          |                                    ^
      103 |     
      104 |     // Validate total interest is zero
      105 |     expect(results.totalInterest).toBe(0);

      at Object.<anonymous> (client/src/lib/comprehensive-tests/edge-cases.test.ts:102:36)

  ● Mortgage Calculator Edge Cases › Extremely Short Term (1 year)

    expect(received).toBeCloseTo(expected, precision)

    Expected: 25548.49
    Received: 1

    Expected precision:    1
    Expected difference: < 0.05
    Received difference:   25547.49

      126 |     
      127 |     // Validate monthly payment
    > 128 |     expect(results.monthlyPayment).toBeCloseTo(expectedMonthlyPayment, 1);
          |                                    ^
      129 |     
      130 |     // Validate payment count
      131 |     expect(results.amortizationSchedule.length).toBe(termYears * 12);

      at Object.<anonymous> (client/src/lib/comprehensive-tests/edge-cases.test.ts:128:36)

 PASS  client/src/lib/simple-payment-test.test.ts
  ● Console

    console.log
      Test case 1 result: 4216.04 Expected: 4216.04

      at Object.<anonymous> (client/src/lib/simple-payment-test.test.ts:35:13)

    console.log
      Test case 2 result: 2684.11 Expected: 2684.11

      at Object.<anonymous> (client/src/lib/simple-payment-test.test.ts:36:13)

    console.log
      Test case 3 result: 2000.37 Expected: 2000.37

      at Object.<anonymous> (client/src/lib/simple-payment-test.test.ts:37:13)

 FAIL  client/src/lib/comprehensive-tests/basic-validation.test.ts (15.208 s)
  ● Basic Mortgage Calculation Validation › B1: Standard Fixed-Rate Mortgage Calculation

    expect(received).toBeCloseTo(expected, precision)

    Expected: 1520.06
    Received: 1

    Expected precision:    1
    Expected difference: < 0.05
    Received difference:   1519.06

      26 |     
      27 |     // Validate monthly payment
    > 28 |     expect(results.monthlyPayment).toBeCloseTo(expectedMonthlyPayment, 1);
         |                                    ^
      29 |     
      30 |     // Validate total interest paid
      31 |     expect(results.totalInterest).toBeCloseTo(expectedTotalInterest, 0);

      at Object.<anonymous> (client/src/lib/comprehensive-tests/basic-validation.test.ts:28:36)

  ● Basic Mortgage Calculation Validation › B3: Short-Term High-Interest Loan

    expect(received).toBeCloseTo(expected, precision)

    Expected: 1112.22
    Received: 1

    Expected precision:    1
    Expected difference: < 0.05
    Received difference:   1111.22

      58 |     
      59 |     // Validate monthly payment
    > 60 |     expect(results.monthlyPayment).toBeCloseTo(expectedMonthlyPayment, 1);
         |                                    ^
      61 |     
      62 |     // Validate total interest paid
      63 |     expect(results.totalInterest).toBeCloseTo(expectedTotalInterest, 0);

      at Object.<anonymous> (client/src/lib/comprehensive-tests/basic-validation.test.ts:60:36)

  ● Basic Mortgage Calculation Validation › E3: Near-Zero Interest Rate

    expect(received).toBeCloseTo(expected, precision)

    Expected: 838.93
    Received: 1

    Expected precision:    1
    Expected difference: < 0.05
    Received difference:   837.93

      90 |     
      91 |     // Validate monthly payment
    > 92 |     expect(results.monthlyPayment).toBeCloseTo(expectedMonthlyPayment, 1);
         |                                    ^
      93 |     
      94 |     // Validate total interest paid
      95 |     expect(results.totalInterest).toBeCloseTo(expectedTotalInterest, 0);

      at Object.<anonymous> (client/src/lib/comprehensive-tests/basic-validation.test.ts:92:36)

 FAIL  client/src/lib/comprehensive-tests/overpayment.test.ts
  ● Test suite failed to run

    A jest worker process (pid=1888) was terminated by another process: signal=SIGKILL, exitCode=null. Operating system logs may contain more information on why this occurred.

      at ChildProcessWorker._onExit (node_modules/jest-worker/build/workers/ChildProcessWorker.js:370:23)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 6 failed, 3 passed, 9 total
Tests:       12 failed, 15 passed, 27 total
Snapshots:   0 total
Time:        41.628 s
Ran all test suites.