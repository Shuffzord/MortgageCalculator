---
phase: 01-typescript-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - client/src/lib/webmcp/types/navigator.ts
  - client/src/lib/webmcp/types/tools.ts
  - client/src/lib/webmcp/types/context.ts
  - client/src/lib/webmcp/types/index.ts
  - client/src/types/webmcp.d.ts
autonomous: true
requirements: [NFR-2, NFR-3]

must_haves:
  truths:
    - "TypeScript compiles without errors for WebMCP types"
    - "navigator.modelContext is recognized by IDE/TypeScript"
    - "Types are importable via @/lib/webmcp"
  artifacts:
    - path: "client/src/lib/webmcp/types/navigator.ts"
      provides: "ModelContext interface definition"
      exports: ["ModelContext"]
    - path: "client/src/lib/webmcp/types/tools.ts"
      provides: "Tool types and branded ToolName type"
      exports: ["ModelContextTool", "ToolName", "toolName", "CalculateMortgageInput", "CalculateMortgageOutput"]
    - path: "client/src/lib/webmcp/types/context.ts"
      provides: "Response and schema types"
      exports: ["JSONSchema", "Content", "ToolResponse"]
    - path: "client/src/lib/webmcp/types/index.ts"
      provides: "Barrel export for all types"
    - path: "client/src/types/webmcp.d.ts"
      provides: "Global navigator augmentation"
      contains: "declare global"
  key_links:
    - from: "client/src/types/webmcp.d.ts"
      to: "navigator.modelContext"
      via: "declare global Navigator interface extension"
      pattern: "interface Navigator"
    - from: "client/src/lib/webmcp/types/index.ts"
      to: "all type files"
      via: "re-export"
      pattern: "export.*from"
---

<objective>
Create type-safe TypeScript infrastructure for WebMCP API integration.

Purpose: Establish foundational types that Phase 2 (tool implementation) and Phase 3 (registration) will depend on. Enables type-safe development of WebMCP tools with IDE support.

Output:
- WebMCP type definitions split by concern (navigator, tools, context)
- Global navigator augmentation for `navigator.modelContext`
- Barrel export for clean imports via `@/lib/webmcp`
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-typescript-foundation/01-CONTEXT.md
@.planning/phases/01-typescript-foundation/01-RESEARCH.md

# Existing project types for convention reference
@client/src/lib/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WebMCP type files by concern</name>
  <files>
    client/src/lib/webmcp/types/navigator.ts
    client/src/lib/webmcp/types/tools.ts
    client/src/lib/webmcp/types/context.ts
    client/src/lib/webmcp/types/index.ts
  </files>
  <action>
Create directory structure `client/src/lib/webmcp/types/` and the following files:

**context.ts** - Response and schema types:
```typescript
/**
 * JSON Schema type (simplified for WebMCP inputSchema)
 */
export type JSONSchema = {
  readonly type: 'object' | 'string' | 'number' | 'boolean' | 'array' | 'null';
  readonly properties?: Readonly<Record<string, JSONSchema>>;
  readonly required?: ReadonlyArray<string>;
  readonly description?: string;
  readonly items?: JSONSchema;
  readonly enum?: ReadonlyArray<string | number>;
  readonly minimum?: number;
  readonly maximum?: number;
  readonly [key: string]: unknown;
};

/**
 * Content block in tool response
 */
export interface Content {
  readonly type: 'text' | 'image' | 'error';
  readonly text?: string;
  readonly data?: string;
  readonly mimeType?: string;
}

/**
 * Tool execution response
 */
export interface ToolResponse {
  readonly content: ReadonlyArray<Content>;
  readonly error?: string;
  readonly code?: string;
}
```

**tools.ts** - Tool types with branded ToolName:
```typescript
import type { JSONSchema, ToolResponse } from './context';

// Branded type for tool names (compile-time safety, zero runtime cost)
declare const toolNameBrand: unique symbol;
export type ToolName = string & { readonly [toolNameBrand]: 'ToolName' };

/**
 * Factory function to create validated ToolName
 */
export function toolName(name: string): ToolName {
  if (!name || name.length < 3 || name.length > 50) {
    throw new Error('Tool name must be 3-50 characters');
  }
  if (!/^[a-zA-Z][a-zA-Z0-9_]*$/.test(name)) {
    throw new Error('Tool name must start with letter, contain only alphanumeric and underscore');
  }
  return name as ToolName;
}

/**
 * WebMCP Tool Definition
 */
export interface ModelContextTool {
  readonly name: ToolName;
  readonly description: string;
  readonly inputSchema: JSONSchema;
  readonly readOnlyHint?: boolean;
  execute(args: unknown): Promise<ToolResponse>;
}

/**
 * calculateMortgage tool input type
 */
export interface CalculateMortgageInput {
  readonly principal: number;
  readonly annualInterestRate: number;
  readonly loanTermYears: number;
  readonly currency?: string;
  readonly repaymentModel?: 'equalInstallments' | 'decreasingInstallments';
}

/**
 * calculateMortgage tool output type
 */
export interface CalculateMortgageOutput {
  readonly summary: {
    readonly monthlyPayment: string;
    readonly totalInterest: string;
    readonly totalCost: string;
    readonly termLength: string;
  };
  readonly details: {
    readonly monthlyPaymentRaw: number;
    readonly totalInterestRaw: number;
    readonly termMonths: number;
  };
  readonly yearlyBreakdown: ReadonlyArray<{
    readonly year: number;
    readonly principalPaid: string;
    readonly interestPaid: string;
    readonly balance: string;
  }>;
  readonly naturalLanguageSummary: string;
}
```

**navigator.ts** - ModelContext interface:
```typescript
import type { ModelContextTool, ToolName } from './tools';

/**
 * ModelContext API - Entry point for WebMCP tool registration
 * Available in Chrome 146+ with chrome://flags/#enable-webmcp-testing
 */
export interface ModelContext {
  /**
   * Register a tool that AI agents can discover and invoke
   */
  registerTool(tool: ModelContextTool): Promise<void>;

  /**
   * Unregister a previously registered tool
   */
  unregisterTool(name: ToolName): Promise<void>;
}
```

**index.ts** - Barrel export:
```typescript
// Navigator types
export type { ModelContext } from './navigator';

// Tool types
export type {
  ModelContextTool,
  ToolName,
  CalculateMortgageInput,
  CalculateMortgageOutput,
} from './tools';
export { toolName } from './tools';

// Context/response types
export type { JSONSchema, Content, ToolResponse } from './context';
```

Key implementation notes:
- Use `type` for unions (JSONSchema type field) and branded types (ToolName)
- Use `interface` for object shapes (ModelContext, ModelContextTool, etc.)
- Apply `readonly` to all properties per user decision
- No 'I' prefix on interfaces per user decision
- kebab-case would be `model-context.ts` but RESEARCH shows navigator.ts/tools.ts/context.ts naming - use those
  </action>
  <verify>
Run `npx tsc --noEmit` from project root. Should compile without errors.
Check files exist: `ls client/src/lib/webmcp/types/`
  </verify>
  <done>
All four type files exist with correct exports. TypeScript compiles without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create global navigator augmentation</name>
  <files>
    client/src/types/webmcp.d.ts
  </files>
  <action>
Create directory `client/src/types/` if it doesn't exist, then create `webmcp.d.ts`:

```typescript
/**
 * WebMCP Navigator Augmentation
 * Extends the global Navigator interface to include modelContext API
 *
 * @see https://webmcp.link/
 * @requires Chrome 146+ with chrome://flags/#enable-webmcp-testing
 */

import type { ModelContext } from '@/lib/webmcp/types';

export {}; // Required: marks file as module for declare global

declare global {
  interface Navigator {
    /**
     * WebMCP Model Context API
     * Available in Chrome 146+ with WebMCP flag enabled
     * @see https://webmcp.link/
     */
    readonly modelContext?: ModelContext;
  }
}
```

Key implementation notes:
- `export {}` is CRITICAL - without it, TypeScript treats file as script and `declare global` fails
- Import ModelContext from the types we just created using `@/` path alias
- Use `readonly` and optional `?` since API may not be available
- JSDoc comments provide IDE documentation
  </action>
  <verify>
Run `npx tsc --noEmit` from project root.
Create a temporary test in any .ts file:
```typescript
// In any file, this should now be recognized:
const ctx = navigator.modelContext; // Should be typed as ModelContext | undefined
```
The IDE should recognize `navigator.modelContext` with proper typing.
  </verify>
  <done>
`client/src/types/webmcp.d.ts` exists with global Navigator augmentation. `navigator.modelContext` is typed correctly as `ModelContext | undefined` in IDE.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create main webmcp barrel export</name>
  <files>
    client/src/lib/webmcp/index.ts
  </files>
  <action>
Create `client/src/lib/webmcp/index.ts` as the main entry point:

```typescript
/**
 * WebMCP Integration Module
 *
 * Provides types and utilities for WebMCP tool registration.
 * Import types from '@/lib/webmcp' for clean imports.
 *
 * @example
 * import type { ModelContext, ModelContextTool, ToolName } from '@/lib/webmcp';
 * import { toolName } from '@/lib/webmcp';
 */

// Re-export all types from types barrel
export type {
  ModelContext,
  ModelContextTool,
  ToolName,
  CalculateMortgageInput,
  CalculateMortgageOutput,
  JSONSchema,
  Content,
  ToolResponse,
} from './types';

// Re-export factory functions
export { toolName } from './types';
```

This enables clean imports like:
- `import type { ModelContext } from '@/lib/webmcp'`
- `import { toolName } from '@/lib/webmcp'`
  </action>
  <verify>
Run `npx tsc --noEmit` from project root.
Verify imports work by checking in IDE - hover over imports should show proper types.
  </verify>
  <done>
Main barrel export exists at `client/src/lib/webmcp/index.ts`. Types importable via `@/lib/webmcp` path.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` passes with no errors
2. File structure exists:
   ```
   client/src/
     lib/webmcp/
       types/
         navigator.ts
         tools.ts
         context.ts
         index.ts
       index.ts
     types/
       webmcp.d.ts
   ```
3. IDE recognizes `navigator.modelContext` with proper typing
4. Import works: `import type { ModelContext } from '@/lib/webmcp'` resolves correctly
</verification>

<success_criteria>
- [ ] All 6 files created with correct content
- [ ] `npx tsc --noEmit` passes without errors
- [ ] `navigator.modelContext` recognized in IDE as `ModelContext | undefined`
- [ ] Types importable via `@/lib/webmcp` path alias
- [ ] No 'any' types used
- [ ] All properties use `readonly` modifier
- [ ] Branded `ToolName` type with factory function
</success_criteria>

<output>
After completion, create `.planning/phases/01-typescript-foundation/01-01-SUMMARY.md`
</output>
