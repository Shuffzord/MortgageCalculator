# Mortgage Calculator Engine Test Specifications

This document outlines a comprehensive set of tests to validate the accuracy and robustness of the mortgage calculator engine. These tests range from basic validation to complex scenarios with changing interest rates and overpayment patterns.

## Basic Validation Tests

### Test B1: Standard Fixed-Rate Mortgage Calculation
**Description**: Validate basic mortgage calculation for a fixed-rate loan with equal installments.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
**Expected Results**:
- Monthly Payment: $1,520.06
- Total Interest Paid: $247,220.13
- Total Amount Paid: $547,220.13

### Test B2: Fixed-Rate Mortgage with Decreasing Installments
**Description**: Validate calculation for a fixed-rate loan with decreasing installments.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
- Payment Type: Decreasing installments
**Expected Results**:
- First Monthly Payment: $2,125.00
- Last Monthly Payment: $835.94
- Total Interest Paid: $224,732.50
- Total Amount Paid: $524,732.50

### Test B3: Short-Term High-Interest Loan
**Description**: Test accuracy for a short-term loan with high interest rate.
**Inputs**:
- Principal: $50,000
- Term: 5 years (60 months)
- Interest Rate: 12% (fixed)
- Payment Frequency: Monthly
**Expected Results**:
- Monthly Payment: $1,112.22
- Total Interest Paid: $16,733.20
- Total Amount Paid: $66,733.20

## Interest Rate Change Tests

### Test I1: One-Time Interest Rate Change
**Description**: Validate calculation with a single interest rate change midway through the loan term.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Initial Interest Rate: 4.5%
- Rate Change: At month 120, rate changes to 5.5%
- Payment Frequency: Monthly
**Expected Results**:
- Initial Monthly Payment: $1,520.06
- Monthly Payment After Change: $1,702.80
- Total Interest Paid: $308,548.32
- Total Amount Paid: $608,548.32

### Test I2: Multiple Scheduled Interest Rate Changes
**Description**: Validate calculation with multiple scheduled interest rate changes.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Initial Interest Rate: 3.5%
- Rate Changes:
  - At month 60, rate changes to 4.0%
  - At month 120, rate changes to 4.5%
  - At month 180, rate changes to 5.0%
  - At month 240, rate changes to 4.5%
- Payment Frequency: Monthly
**Expected Results**:
- Initial Monthly Payment: $1,347.13
- Payment After First Change: $1,454.80
- Payment After Second Change: $1,567.37
- Payment After Third Change: $1,680.33
- Payment After Fourth Change: $1,623.55
- Total Interest Paid: $273,695.81
- Total Amount Paid: $573,695.81

### Test I3: Adjustable Rate Mortgage (ARM) Simulation
**Description**: Test an ARM with initial fixed period followed by annual adjustments based on an index.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Initial Interest Rate: 3.5% (fixed for 5 years)
- After fixed period: Base index + 2.5% margin
- Base index values (simulated):
  - Year 6: 1.5% (resulting in 4.0% rate)
  - Year 7: 2.0% (resulting in 4.5% rate)
  - Year 8: 2.5% (resulting in 5.0% rate)
  - Year 9: 3.0% (resulting in 5.5% rate)
  - Years 10-30: 2.5% (resulting in 5.0% rate)
- Rate adjustment caps: 2% initial adjustment, 1% periodic, 5% lifetime
- Payment Frequency: Monthly
**Expected Results**:
- Initial Monthly Payment: $1,347.13
- Year 6 Monthly Payment: $1,454.80
- Year 7 Monthly Payment: $1,552.50
- Year 8 Monthly Payment: $1,651.90
- Year 9 Monthly Payment: $1,746.75
- Years 10-30 Monthly Payment: $1,687.71
- Total Interest Paid: approximately $290,800
- Total Amount Paid: approximately $590,800

## Overpayment Tests

### Test O1: One-Time Overpayment with Term Reduction
**Description**: Test impact of a single large overpayment with loan term reduction.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
- Regular Monthly Payment: $1,520.06
- Overpayment: $50,000 at month 60
- Overpayment Effect: Reduce term (keep payment amount)
**Expected Results**:
- New Term After Overpayment: approximately 22 years 8 months (272 months total)
- Total Interest Saved: approximately $71,500
- Total Interest Paid: approximately $175,720
- Total Amount Paid: approximately $475,720

### Test O2: One-Time Overpayment with Payment Reduction
**Description**: Test impact of a single large overpayment with payment reduction.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
- Original Monthly Payment: $1,520.06
- Overpayment: $50,000 at month 60
- Overpayment Effect: Reduce payment (keep term)
**Expected Results**:
- New Monthly Payment After Overpayment: approximately $1,266.72
- Total Interest Paid: approximately $209,000
- Total Interest Saved: approximately $38,220
- Total Amount Paid: approximately $509,000

### Test O3: Regular Monthly Overpayments
**Description**: Test the impact of consistent monthly overpayments.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
- Regular Monthly Payment: $1,520.06
- Additional Monthly Overpayment: $200 (every month starting from month 1)
- Overpayment Effect: Reduce term (keep payment amount)
**Expected Results**:
- New Term: approximately 24 years 8 months (296 months)
- Total Interest Paid: approximately $193,800
- Total Interest Saved: approximately $53,420
- Total Amount Paid: approximately $493,800

### Test O4: Annual Bonus Overpayments
**Description**: Test the impact of regular annual overpayments (e.g., from bonuses).
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
- Regular Monthly Payment: $1,520.06
- Annual Overpayment: $5,000 (every 12 months starting from month 12)
- Overpayment Effect: Reduce term (keep payment amount)
**Expected Results**:
- New Term: approximately 22 years 2 months (266 months)
- Total Interest Paid: approximately $172,300
- Total Interest Saved: approximately $74,920
- Total Amount Paid: approximately $472,300

## Complex Scenario Tests

### Test C1: Fixed-to-Variable Rate with Increasing Overpayments
**Description**: Test a complex scenario with initial fixed rate period, followed by variable rate and increasing overpayments.
**Inputs**:
- Principal: $400,000
- Term: 30 years (360 months)
- Initial Interest Rate: 3.25% (fixed for 5 years)
- Rate Changes:
  - At month 60, rate changes to 4.25%
  - At month 120, rate changes to 4.75%
  - At month 180, rate changes to 5.25%
- Payment Frequency: Monthly
- Overpayments:
  - Years 1-2: No overpayments
  - Years 3-5: $200/month extra
  - Years 6-10: $500/month extra
  - Years 11+: $800/month extra
- Overpayment Effect: Reduce term (keep payment amount)
**Expected Results**:
- Initial Monthly Payment: $1,740.83
- Payment After First Rate Change: $1,920.82
- Payment After Second Rate Change: $2,041.98
- Payment After Third Rate Change: $2,162.91
- Total Overpayments: approximately $168,800
- New Term: approximately 19 years 6 months (234 months)
- Total Interest Paid: approximately $213,500
- Total Interest Saved: approximately $189,700
- Total Amount Paid: approximately $613,500

### Test C2: Bi-Weekly Payments with Rate Changes and Lump Sum Overpayments
**Description**: Test bi-weekly payment schedule with interest rate changes and periodic lump sum overpayments.
**Inputs**:
- Principal: $350,000
- Term: 30 years (780 bi-weekly periods)
- Initial Interest Rate: 4.0% (fixed for 3 years)
- Rate Changes:
  - At period 78, rate changes to 4.5%
  - At period 260, rate changes to 5.0%
- Payment Frequency: Bi-weekly
- Regular Bi-Weekly Payment: $769.57 (equivalent to monthly $1,667.40)
- Lump Sum Overpayments:
  - $10,000 at period 104 (year 4)
  - $15,000 at period 208 (year 8)
  - $20,000 at period 312 (year 12)
- Overpayment Effect: Reduce term (keep payment amount)
**Expected Results**:
- New Term: approximately 21 years (546 bi-weekly periods)
- Total Interest Paid: approximately $182,600
- Total Interest Saved: approximately $105,800
- Total Amount Paid: approximately $532,600

### Test C3: Split-Rate Mortgage with Variable Overpayments
**Description**: Test a split-rate mortgage where part is fixed and part is variable, with variable overpayment patterns.
**Inputs**:
- Total Principal: $500,000
  - Fixed Portion: $300,000 at 3.75% (fixed for the term)
  - Variable Portion: $200,000 initially at 3.25%
- Term: 25 years (300 months)
- Variable Rate Changes:
  - At month 60, variable rate changes to 3.75%
  - At month 120, variable rate changes to 4.25%
  - At month 180, variable rate changes to 4.75%
- Payment Frequency: Monthly
- Overpayment Strategy:
  - First 5 years: Extra $400/month applied to variable portion
  - Years 6-10: Extra $600/month applied to variable portion
  - Years 11-15: Extra $800/month applied to fixed portion
  - One-time payment of $30,000 at month 150 applied to fixed portion
- Overpayment Effect: Reduce term (keep payment amounts)
**Expected Results**:
- Initial Combined Monthly Payment: $2,605.40
- Month 60 Combined Payment: $2,641.21
- Month 120 Combined Payment: $2,684.37
- Month 180 Combined Payment: $2,653.12
- Variable Portion Paid Off: approximately month 165
- Fixed Portion Paid Off: approximately month 217
- New Overall Term: approximately 18 years 1 month (217 months)
- Total Interest Paid: approximately $228,900
- Total Interest Saved: approximately $141,500
- Total Amount Paid: approximately $728,900

## Edge Case Tests

### Test E1: Extra-Long Term Mortgage
**Description**: Test accuracy for an unusually long mortgage term.
**Inputs**:
- Principal: $300,000
- Term: 40 years (480 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
**Expected Results**:
- Monthly Payment: $1,363.95
- Total Interest Paid: $354,695.47
- Total Amount Paid: $654,695.47

### Test E2: Very Large Principal Amount
**Description**: Test calculation accuracy with a very large loan amount.
**Inputs**:
- Principal: $5,000,000
- Term: 30 years (360 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
**Expected Results**:
- Monthly Payment: $25,334.37
- Total Interest Paid: $4,120,372.51
- Total Amount Paid: $9,120,372.51

### Test E3: Near-Zero Interest Rate
**Description**: Test behavior with extremely low interest rate.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Interest Rate: 0.1% (fixed)
- Payment Frequency: Monthly
**Expected Results**:
- Monthly Payment: $838.93
- Total Interest Paid: $2,015.48
- Total Amount Paid: $302,015.48

### Test E4: Zero Overpayment Fee Test
**Description**: Test handling of overpayments with fees/penalties.
**Inputs**:
- Principal: $300,000
- Term: 30 years (360 months)
- Interest Rate: 4.5% (fixed)
- Payment Frequency: Monthly
- Overpayment: $30,000 at month 24
- Overpayment Fee: 2% of overpayment amount ($600)
- Overpayment Effect: Reduce term (keep payment amount)
**Expected Results**:
- Effective Overpayment Applied to Principal: $29,400
- New Term: approximately 25 years 9 months (309 months)
- Total Interest Saved (after fee): approximately $43,200
- Total Amount Paid (including fee): approximately $504,620

## Calculation Accuracy Tests

### Test A1: Amortization Schedule Validation
**Description**: Verify that the amortization schedule accurately reflects principal and interest portions throughout the loan.
**Inputs**:
- Principal: $200,000
- Term: 15 years (180 months)
- Interest Rate: 3.5% (fixed)
- Payment Frequency: Monthly
**Validation Points**:
- First Month Payment Breakdown: $1,429.77 total, $429.17 interest, $1,000.60 principal
- Month 60 Payment Breakdown: $1,429.77 total, $321.35 interest, $1,108.42 principal
- Month 120 Payment Breakdown: $1,429.77 total, $203.12 interest, $1,226.65 principal
- Month 179 Payment Breakdown: $1,429.77 total, $5.06 interest, $1,424.71 principal
- Final balance should be zero (within rounding tolerance)
- Sum of all principal payments should equal original loan amount
- Sum of all interest payments should equal total interest paid

### Test A2: Payment Frequency Conversion Test
**Description**: Verify that different payment frequencies correctly convert the monthly calculation.
**Inputs**:
- Principal: $300,000
- Term: 30 years
- Interest Rate: 4.5% (fixed)
**Compare Frequencies**:
- Monthly: $1,520.06 payment, 360 payments
- Bi-weekly: $701.56 payment, 780 payments
- Accelerated Bi-weekly: $760.03 payment, 780 payments
- Weekly: $350.78 payment, 1560 payments
- Accelerated Weekly: $380.02 payment, 1560 payments
**Expected Results**:
- Total amount paid should be approximately the same across frequencies
- Accelerated payments should result in earlier payoff and interest savings
- Accelerated bi-weekly should pay off approximately 4 years earlier than monthly
- Verify interest calculations are correct for each frequency

### Test A3: Round-Off Error Accumulation Test
**Description**: Test the engine for accumulation of round-off errors over the full term.
**Inputs**:
- Principal: $333,333.33
- Term: 30 years (360 months)
- Interest Rate: 4.33% (fixed)
- Payment Frequency: Monthly
**Expected Results**:
- Monthly Payment should be calculated correctly: approximately $1,654.55
- Final payment should properly adjust to clear the balance
- Sum of all payments should equal principal plus calculated total interest (within 1 cent)
- Final balance after all payments should be exactly zero

## Performance Tests

### Test P1: Calculation Speed Test
**Description**: Measure the time required to perform complex calculations.
**Test Procedure**:
1. Calculate a standard 30-year mortgage
2. Calculate the same mortgage with 10 interest rate changes
3. Calculate the same mortgage with 120 monthly overpayments
4. Calculate 100 different mortgage scenarios in batch
**Expected Results**:
- Individual calculations should complete in under 100ms
- Batch calculations should show linear scaling

### Test P2: Memory Usage Test
**Description**: Verify that memory usage remains reasonable during calculations.
**Test Procedure**:
1. Calculate a 40-year mortgage with monthly compounding (480 periods)
2. Generate complete amortization schedule with payment breakdown
3. Calculate and store 50 different mortgage scenarios simultaneously
**Expected Results**:
- Memory usage should remain stable
- No memory leaks should be detected
- Performance should not degrade with multiple calculations